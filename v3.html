<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hangman: Harvest Town Edition ‚Äî Login ‚Ä¢ 3 Difficulties ‚Ä¢ Ranking (Fixed)</title>
  <style>
    :root {
      --bg: #0f172a;
      --surface: #111827;
      --muted: #1f2937;
      --text: #FFFFFF;
      --accent: #60a5fa;
      --good: #34d399;
      --bad: #f87171;
      --warn: #fbbf24;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background: var(--bg); color: var(--text); }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
    .card { background: var(--surface); border: 1px solid #1f2937; border-radius: 16px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    h1,h2,h3{ margin:0 0 12px }
    .grid { display:grid; gap:16px }
    .grid-2 { grid-template-columns: repeat(2, minmax(0,1fr)); }
    .grid-3 { grid-template-columns: repeat(3, minmax(0,1fr)); }
    .btn{ appearance:none; background:var(--muted); color:#FFFFFF(--text); border:1px solid #374151; border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:600 }
    .btn-primary{ background:var(--accent); color:#071126 }
    .btn-good{ background:var(--good); color:#052e1e }
    .input, textarea { width:100%; background:#0b1220; color:var(--text); border:1px solid #334155; border-radius:12px; padding:10px 12px }
    .kbd{ display:inline-flex; align-items:center; justify-content:center; min-width:32px; padding:6px 8px; border-radius:10px; border:1px solid #334155; background:#0b1220; font-weight:700; margin:4px }
    .row{ display:flex; gap:12px; align-items:center; flex-wrap:wrap }
    .pill{ padding:6px 10px; border-radius:999px; border:1px solid #374151; background:#0b1220; font-weight:700 }
    .hidden{ display:none !important }
    .word{ letter-spacing:.3em; font-size:36px; font-weight:800; text-align:center; padding:12px 16px; border-radius:12px; background:#0b1220; border:1px dashed #334155 }
    .progress{ width:100%; background:#0b1220; border:1px solid #334155; border-radius:12px; overflow:hidden; height:12px }
    .bar{ height:100%; background:var(--accent); width:0%; transition:width .3s }
    table{ width:100%; border-collapse:collapse }
    th,td{ border-bottom:1px solid #243041; padding:10px; text-align:left }
    .hangman{ min-height:140px; display:flex; align-items:center; justify-content:center }
    .gallows{ font-family: "Courier New", monospace; white-space:pre; line-height:1.05 }
    .footnote{ font-size:12px; opacity:.85 }
    .tag{ font-size:12px; opacity:.9 }
  </style>
</head>
<body>
  <div class="container">
    <div class="card" id="screen-login">
      <h1>üîê Hangman:Harvest Town Edition ‚Äî Player Login</h1>
      <p>Enter your IGN and Player ID to play. Words are curated by the Host.</p>
      <h2>How to Play<h2>
        <h4><li>Guess one letter at a time. Correct guesses reveal letters.
        <li>Wrong guesses draw the hangman. You have limited lives.
        <li>Reveal the answer before you run out of lives. Goodluck!<h4>

      <div class="grid grid-2">
        <div>
          <label for="ign">IGN</label>
          <input id="ign" class="input" placeholder="e.g. GM HarYu" maxlength="24" />
        </div>
        <div>
          <label for="pid">Player ID</label>
          <input id="pid" class="input" placeholder="e.g. 13399604" maxlength="24" />
        </div>
      </div>

      <div class="row" style="margin-top:12px; justify-content:space-between;">
        <div class="footnote">After game ends (30 rounds), your score is added to the local ranking.</div>
        <button id="btnStart" class="btn btn-primary">Start Game</button>
      </div>

      <hr style="margin:18px 0; border-color:#1f2937;" />

      <details>
        <summary>üõ†Ô∏è Host Settings (words & options) ‚Äî protected</summary>
        <div style="margin-top:12px;">
          <div style="display:flex; gap:12px; align-items:center;">
            <label style="min-width:130px">Enter Host Passcode</label>
            <input id="hostPass" class="input" type="password" placeholder="passcode" style="max-width:280px;" />
            <button id="btnCheckPassword" class="btn">Unlock Host Settings</button>
            <div id="hiddenContent" style="display: none;"
            <div class="footnote"><code id="passnote">host123</code></div>
          </div>

          <!-- host controls are disabled / hidden until correct passcode entered -->
          <div id="hostControls" class="hidden" style="margin-top:12px;">
            <div class="grid grid-3">
              <div>
                <label>Lives per round</label>
                <input id="livesPerRound" type="number" class="input" min="3" max="10" value="6" />
              </div>
              <div>
                <label>Scoring (E / M / H base)</label>
                <div class="row">
                  <input id="scoreE" type="number" class="input" value="10" style="max-width:90px;" />
                  <input id="scoreM" type="number" class="input" value="20" style="max-width:90px;" />
                  <input id="scoreH" type="number" class="input" value="30" style="max-width:90px;" />
                </div>
                <div class="footnote">Solved round awards base points + remaining lives as bonus.</div>
              </div>
              <div></div>
            </div>

            <div class="grid grid-3" style="margin-top:12px;">
              <div>
                <label>Easy Words (one per line)</label>
                <textarea id="wordsE" rows="8" class="input"></textarea>
              </div>
              <div>
                <label>Medium Words (one per line)</label>
                <textarea id="wordsM" rows="8" class="input"></textarea>
              </div>
              <div>
                <label>Hard Words (one per line)</label>
                <textarea id="wordsH" rows="8" class="input"></textarea>
              </div>
            </div>

            <div style="margin-top:12px; display:flex; justify-content:flex-end; gap:8px;">
              <button id="btnApplyHost" class="btn btn-good">Apply Host Settings</button>
              <button id="btnLockHost" class="btn">Lock Host Settings</button>
            </div>

            <div class="footnote" style="margin-top:10px;">Players cannot access or change these without the passcode. All words are stored locally in this browser.</div>
          </div>
        </div>
      </details>
    </div>

    <!-- GAME SCREEN -->
    <div id="screen-game" class="card hidden">
      <div class="row" style="justify-content:space-between; align-items:flex-start;">
        <div>
          <h2>üéØ Hangman: Harvest Town</h2>
          <div class="tag" id="playerTag">IGN ‚Äî Player ID</div>
        </div>
        <div class="scorebox" style="display:grid; grid-template-columns:repeat(4, minmax(0,1fr)); gap:8px;">
          <div><div class="tag">Round</div><div id="roundInfo">1 / 30</div></div>
          <div><div class="tag">Phase</div><div id="phaseInfo">Easy 1/10</div></div>
          <div><div class="tag">Lives</div><div id="livesInfo">6</div></div>
          <div><div class="tag">Score</div><div id="scoreInfo">0</div></div>
        </div>
      </div>

      <div class="progress" style="margin:12px 0 8px;"><div class="bar" id="progBar"></div></div>
      <div class="row" style="justify-content:space-between;"><div class="pill" id="difficultyPill">Easy</div><div class="pill">Solve bonus = remaining lives</div></div>

      <div class="card" style="margin-top:16px;"><p style="background-color: yellow; color: purple;"></p>
        <div class="hangman"><pre class="gallows" id="gallows">  +---+\n  |   |\n      |\n      |\n      |\n      |\n=========</pre></div>
        <div class="word" id="wordDisplay">_ _ _ _</div>
        <div class="center" style="margin-top:10px;" id="hintArea"></div>
        <div class="center footnote" id="statusMsg" style="min-height:22px;">Pick a letter‚Ä¶</div>
        <div id="letters" class="center" style="margin-top:8px;"></div>
      </div>

      <div class="row" style="justify-content:space-between; margin-top:8px;">
        <div class="pill" id="usedLetters">Used: </div>
        <div class="row"><span class="pill">Incorrect: <b id="misses">0</b></span><span class="pill">Correct: <b id="hits">0</b></span></div>
      </div>
    </div>

    <!-- FINALE -->
    <div id="screen-finale" class="card hidden">
      <h2>üèÅ Game Over ‚Äî Final Score</h2>
      <p id="finalLine"></p>
      <div class="grid grid-2">
        <div>
          <div class="card" style="background:#0b1220;"><h3>Your Breakdown</h3><ul id="breakdown"></ul></div>
        </div>
        <div>
          <div class="card" style="background:#0b1220;"><h3>üèÜ Local Ranking</h3>
            <table><thead><tr><th>#</th><th>IGN</th><th>Player ID</th><th>Score</th><th>Date</th></tr></thead><tbody id="rankBody"></tbody></table>
            <div class="footnote" style="color:var(--warn)">There is no restart/play-again button. Reload the page for a new player session.</div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    /* =====================
       ‚úÖ BUGFIX: The original document referenced an inline onclick="checkPassword()"
       but there was no function defined which caused the ReferenceError. This updated
       file fixes that by implementing a proper checkPassword flow and also makes
       all important DOM references explicit (no reliance on implicit globals).
       ===================== */

    // Storage keys
    const STORAGE_KEYS = { host: 'hangman_host_config_v1', rank: 'hangman_rankings_v1' };

    // Default banks
    const DEFAULT_WORDS = {
      easy: `apple\nchair\nriver\nplanet\ncloud\nrobot\nfriend\nwindow\nlemon\nbanana\norange\nmonkey\nforest\nshadow\nkitten\npizza\nblanket\ncoffee\nbridge\nsunset\nkeyboard\nschool\nfamily\nmusic\nnovel\nbutton\ntravel\nrocket\npepper\nmagnet`,
      medium: `gravity\npolygon\noxygen\nlantern\nquantum\norchard\ncompass\nfracture\nneutral\ncrystal\ndescent\ntexture\narchive\nblossom\nspectrum\nvoltage\nbreeze\ncapstone\nmarbles\nplasma\napricot\nmiracle\nwhisper\ntrident\nreticle\nventure\ncarrier\nresolve\nmetrics\nswitcher`,
      hard: `juxtapose\nmnemonic\nzephyr\nquixotic\nbyzantine\nchiaroscuro\nsyzygy\nschadenfreude\nflummox\ndichotomy\naxiomatic\nobfuscate\nquarantine\nrendezvous\nparadigm\nreconnaissance\nknapsack\nmnemonics\npsoriasis\nbourgeois\nukulele\nquizzical\npterodactyl\nclaustrophobia\nptomaine\nrhythmic\nsubterfuge\nconscientious\nanachronism\nhyperbole`
    };

    const DEFAULT_CONFIG = {
      passcode: 'HTGMHARYU1324',
      lives: 6,
      scoreBase: { E: 10, M: 20, H: 30 },
      words: { E: DEFAULT_WORDS.easy.split('\n'), M: DEFAULT_WORDS.medium.split('\n'), H: DEFAULT_WORDS.hard.split('\n') }
    };

    function loadHostConfig(){
      try{
        const raw = localStorage.getItem(STORAGE_KEYS.host);
        if (!raw) return structuredClone(DEFAULT_CONFIG);
        const cfg = JSON.parse(raw);
        cfg.passcode = cfg.passcode || DEFAULT_CONFIG.passcode;
        cfg.lives = Number(cfg.lives || DEFAULT_CONFIG.lives);
        cfg.scoreBase = cfg.scoreBase || DEFAULT_CONFIG.scoreBase;
        cfg.words = cfg.words || DEFAULT_CONFIG.words;
        return cfg;
      }catch(e){ return structuredClone(DEFAULT_CONFIG); }
    }
    function saveHostConfig(cfg){ localStorage.setItem(STORAGE_KEYS.host, JSON.stringify(cfg)); }

    function getRanking(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEYS.rank) || '[]'); } catch(e) { return []; } }
    function saveRanking(list){ localStorage.setItem(STORAGE_KEYS.rank, JSON.stringify(list)); }

    // DOM references (explicit)
    const ign = document.getElementById('ign');
    const pid = document.getElementById('pid');
    const btnStart = document.getElementById('btnStart');

    const hostPass = document.getElementById('hostPass');
    const btnCheckPassword = document.getElementById('btnCheckPassword');
    const hostControls = document.getElementById('hostControls');
    const passnote = document.getElementById('passnote');

    const livesPerRound = document.getElementById('livesPerRound');
    const scoreE = document.getElementById('scoreE');
    const scoreM = document.getElementById('scoreM');
    const scoreH = document.getElementById('scoreH');
    const wordsE = document.getElementById('wordsE');
    const wordsM = document.getElementById('wordsM');
    const wordsH = document.getElementById('wordsH');
    const btnApplyHost = document.getElementById('btnApplyHost');
    const btnLockHost = document.getElementById('btnLockHost');

    const screenLogin = document.getElementById('screen-login');
    const screenGame = document.getElementById('screen-game');
    const screenFinale = document.getElementById('screen-finale');

    const playerTag = document.getElementById('playerTag');
    const roundInfo = document.getElementById('roundInfo');
    const phaseInfo = document.getElementById('phaseInfo');
    const difficultyPill = document.getElementById('difficultyPill');
    const livesInfo = document.getElementById('livesInfo');
    const scoreInfo = document.getElementById('scoreInfo');
    const progBar = document.getElementById('progBar');

    const gallows = document.getElementById('gallows');
    const wordDisplay = document.getElementById('wordDisplay');
    const hintArea = document.getElementById('hintArea');
    const statusMsg = document.getElementById('statusMsg');
    const letters = document.getElementById('letters');
    const usedLetters = document.getElementById('usedLetters');
    const misses = document.getElementById('misses');
    const hits = document.getElementById('hits');

    const rankBody = document.getElementById('rankBody');
    const finalLine = document.getElementById('finalLine');
    const breakdown = document.getElementById('breakdown');

    // load host configuration and reflect passcode in UI note
    const hostCfg = loadHostConfig();
    passnote.textContent = hostCfg.passcode;

    // populate host inputs from config
    wordsE.value = (hostCfg.words && hostCfg.words.E ? hostCfg.words.E.join('\n') : DEFAULT_WORDS.easy);
    wordsM.value = (hostCfg.words && hostCfg.words.M ? hostCfg.words.M.join('\n') : DEFAULT_WORDS.medium);
    wordsH.value = (hostCfg.words && hostCfg.words.H ? hostCfg.words.H.join('\n') : DEFAULT_WORDS.hard);
    livesPerRound.value = hostCfg.lives;
    scoreE.value = hostCfg.scoreBase.E;
    scoreM.value = hostCfg.scoreBase.M;
    scoreH.value = hostCfg.scoreBase.H;

    // Host unlock / lock
    function checkPassword(){
      const attempt = (hostPass.value || '').trim();
      if (!attempt) { alert('Enter host passcode.'); return; }
      if (attempt === hostCfg.passcode){
        hostControls.classList.remove('hidden');
        hostPass.value = '';
        hostPass.blur();
      } else {
        alert('Incorrect host passcode.');
      }
    }

    function lockHostControls(){
      hostControls.classList.add('hidden');
      hostPass.value = '';
    }

    btnCheckPassword.addEventListener('click', checkPassword);
    btnLockHost.addEventListener('click', lockHostControls);

    // Apply host settings (explicit check again)
    btnApplyHost.addEventListener('click', () => {
      const pass = (hostPass.value || '').trim();
      // If hostControls visible we treat it as already unlocked; but still verify against stored passcode
      // We'll accept either current hostCfg.passcode or re-open prompt
      if (!hostControls.classList.contains('hidden') || pass === hostCfg.passcode){
        const clean = s => (s||'').split('\n').map(w => w.trim().toLowerCase()).filter(Boolean);
        hostCfg.words = { E: Array.from(new Set(clean(wordsE.value))), M: Array.from(new Set(clean(wordsM.value))), H: Array.from(new Set(clean(wordsH.value))) };
        hostCfg.lives = Math.max(3, Math.min(10, Number(livesPerRound.value || 6)));
        hostCfg.scoreBase = { E: Number(scoreE.value || 10), M: Number(scoreM.value || 20), H: Number(scoreH.value || 30) };
        saveHostConfig(hostCfg);
        alert('Host settings applied and saved locally.');
        lockHostControls();
      } else {
        alert('You must unlock host settings with the correct passcode before applying.');
      }
    });

    /* =====================
       üéÆ GAME STATE & FLOW
       ===================== */
    const ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');

    const state = {
      ign: '', pid: '', totalRounds:30, roundsPerTier:10, tier:'E', tierIndex:0, round:1,
      word:'', revealed:[], used: new Set(), lives: hostCfg.lives, misses:0, hits:0, score:0, breakdown:[], pools:{E:[],M:[],H:[]}
    };

    function initPools(){
      state.pools.E = shuffle([...hostCfg.words.E]);
      state.pools.M = shuffle([...hostCfg.words.M]);
      state.pools.H = shuffle([...hostCfg.words.H]);
    }

    function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr }

    function nextTierAndIndex(){ if (state.round<=10){ state.tier='E'; state.tierIndex=state.round-1 } else if (state.round<=20){ state.tier='M'; state.tierIndex=state.round-11 } else { state.tier='H'; state.tierIndex=state.round-21 } }

    function drawGallows(l){
      const stages = [
`  +---+\n  |   |\n      |\n      |\n      |\n      |\n=========`,
`  +---+\n  |   |\n  O   |\n      |\n      |\n      |\n=========`,
`  +---+\n  |   |\n  O   |\n  |   |\n      |\n      |\n=========`,
`  +---+\n  |   |\n  O   |\n /|   |\n      |\n      |\n=========`,
`  +---+\n  |   |\n  O   |\n /|\\  |\n      |\n      |\n=========`,
`  +---+\n  |   |\n  O   |\n /|\\  |\n /    |\n      |\n=========`,
`  +---+\n  |   |\n  O   |\n /|\\  |\n / \\ |\n      |\n=========`
      ];
      // compute index using configured max lives
      const maxLives = Number(hostCfg.lives) || 6;
      const idx = Math.max(0, Math.min(stages.length-1, maxLives - l));
      gallows.textContent = stages[idx];
    }

    function updateHUD(){
      playerTag.textContent = `${state.ign} ‚Äî ${state.pid}`;
      roundInfo.textContent = `${state.round} / ${state.totalRounds}`;
      const tierName = state.tier==='E' ? 'Easy' : (state.tier==='M' ? 'Medium' : 'Hard');
      phaseInfo.textContent = `${tierName} ${state.tierIndex+1}/10`;
      difficultyPill.textContent = tierName;
      livesInfo.textContent = state.lives;
      scoreInfo.textContent = state.score;
      misses.textContent = state.misses;
      hits.textContent = state.hits;
      progBar.style.width = `${((state.round-1)/state.totalRounds)*100}%`;
      usedLetters.textContent = 'Used: ' + (Array.from(state.used).sort().join(' ') || '‚Äî');
      drawGallows(state.lives);
    }

    function pickWord(){
      const pool = state.pools[state.tier];
      if (!pool || pool.length === 0){ state.pools[state.tier] = shuffle([...hostCfg.words[state.tier]] || []); }
      const w = state.pools[state.tier].pop() || 'placeholder';
      return w.toLowerCase();
    }

    function setWord(w){
      state.word = w;
      state.revealed = w.split('').map(ch => (/^[a-z]$/i.test(ch) ? '_' : ch));
      state.used = new Set();
      state.lives = Number(hostCfg.lives) || 6;
      state.misses = 0; state.hits = 0;
      renderWord(); updateHUD(); statusMsg.textContent = 'Pick a letter‚Ä¶'; buildKeyboard();
    }

    function renderWord(){ wordDisplay.textContent = state.revealed.join(' ') }

    // ensure we don't double-register keydown listeners
    function buildKeyboard(){
      letters.innerHTML = '';
      ALPHABET.forEach(letter => {
        const btn = document.createElement('button'); btn.className='kbd'; btn.textContent=letter; btn.disabled = state.used.has(letter);
        btn.addEventListener('click', () => guess(letter)); letters.appendChild(btn);
      });
      document.removeEventListener('keydown', keyHandler);
      document.addEventListener('keydown', keyHandler);
    }

    function keyHandler(e){ if (!/^[a-z]$/i.test(e.key)) return; const letter = e.key.toUpperCase(); const btn = Array.from(letters.children).find(b => b.textContent === letter); if (btn && !btn.disabled) btn.click(); }

    function endRound(solved){
      const base = state.tier==='E' ? hostCfg.scoreBase.E : (state.tier==='M' ? hostCfg.scoreBase.M : hostCfg.scoreBase.H);
      let gained = 0;
      if (solved){ gained = (Number(base) || 0) + (Number(state.lives) || 0); state.score += gained; statusMsg.textContent = `‚úî Correct! +${gained} points`; }
      else { statusMsg.textContent = `‚úñ The word was "${state.word}"`; }
      state.breakdown.push(`${state.round}. [${state.tier}] ${state.word} ‚Äî ${solved?('Solved, +' + gained):'Failed'}`);
      Array.from(letters.children).forEach(b => b.disabled = true);
      document.removeEventListener('keydown', keyHandler);

      setTimeout(() => {
        state.round++;
        if (state.round>state.totalRounds) return finishGame();
        nextTierAndIndex();
        const next = pickWord();
        setWord(next);
      }, 900);
    }

    function guess(letter){
      state.used.add(letter);
      const btn = Array.from(letters.children).find(b => b.textContent === letter);
      if (btn) btn.disabled = true;
      const indices = [];
      for (let i=0;i<state.word.length;i++){ if (state.word[i].toUpperCase() === letter) indices.push(i); }
      if (indices.length){ indices.forEach(i => state.revealed[i] = state.word[i]); state.hits += 1; renderWord(); updateHUD(); if (state.revealed.join('') === state.word) endRound(true); }
      else { state.misses += 1; state.lives -= 1; updateHUD(); if (state.lives <= 0) endRound(false); }
    }

    function startGame(){ state.round = 1; nextTierAndIndex(); initPools(); const w = pickWord(); setWord(w); screenLogin.classList.add('hidden'); screenGame.classList.remove('hidden'); }

    function finishGame(){ screenGame.classList.add('hidden'); screenFinale.classList.remove('hidden'); finalLine.textContent = `${state.ign} ‚Äî ${state.pid} scored ${state.score} points.`; breakdown.innerHTML = ''; state.breakdown.forEach(line => { const li = document.createElement('li'); li.textContent = line; breakdown.appendChild(li); });
      const ranks = getRanking(); ranks.push({ ign: state.ign, pid: state.pid, score: state.score, date: new Date().toLocaleString() }); ranks.sort((a,b)=> b.score - a.score); saveRanking(ranks.slice(0,100)); renderRanking(); }

    function renderRanking(){ const ranks = getRanking(); rankBody.innerHTML = ''; ranks.forEach((r, idx) => { const tr = document.createElement('tr'); tr.innerHTML = `<td>${idx+1}</td><td>${r.ign}</td><td>${r.pid}</td><td><b>${r.score}</b></td><td>${r.date}</td>`; rankBody.appendChild(tr); }); }

    // Start button
    btnStart.addEventListener('click', () => { const ignV = (ign.value||'').trim(); const pidV = (pid.value||'').trim(); if (!ignV || !pidV) { alert('IGN & Player ID are required.'); return; } state.ign = ignV; state.pid = pidV; startGame(); updateHUD(); });

    // initialize ranking table
    renderRanking();

    // Export functions for debugging in dev console (optional)
    window._hangman = { state, hostCfg, startGame, finishGame };
  </script>
</body>
</html>
